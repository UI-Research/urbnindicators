<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How to Open a Pull Request • urbnindicators</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to Open a Pull Request">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">urbnindicators</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9301</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/urbnindicators.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/codebook.html">The urbnindicators Codebook</a></li>
    <li><a class="dropdown-item" href="../articles/design-philosophy.html">Design Philosophy</a></li>
    <li><a class="dropdown-item" href="../articles/opening-a-pull-request.html">How to Open a Pull Request</a></li>
    <li><a class="dropdown-item" href="../articles/quantified-survey-error.html">Drawing Inferences while Accounting for Survey Error</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>How to Open a Pull Request</h1>
            
      

      <div class="d-none name"><code>opening-a-pull-request.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ui-research.github.io/urbnindicators/">urbnindicators</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a></span><span class="op">)</span></span></code></pre></div>
<p>Pull requests (PRs) are a way to propose changes to the codebase of a
project. They allow you to suggest changes, improvements, or fixes to
the code, and they provide a platform for discussion and review before
those changes are merged into the main codebase.</p>
<p>For <code><a href="https://ui-research.github.io/urbnindicators/">library(urbnindicators)</a></code>, a common use-case for a PR
is to propose a new variable or series of variable. This vignette will
illustrate the complete PR process for a new series of variables,
including where the PR should propose codebase updates and the
supporting tests and verifications submitted with the PR to assert that
the newly-created variables are correctly calculated and appropriately
documented.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>There are five places in the codebase that should either be updated
or quality-checked as part of the process of adding a new variable(s).
These include:</p>
<ol style="list-style-type: decimal">
<li><p><code>R/list_acs_variables.R</code>: this is where the desired
variable codes are selected before being passed to
<code><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">tidycensus::get_acs()</a></code>.</p></li>
<li><p><code>R/compile_acs_data.R</code>, specifically within
<code><a href="../reference/internal_compute_acs_variables.html">internal_compute_acs_variables()</a></code>: this is where new derived
variables are created, e.g., by standardizing counts by their table
denominators.</p></li>
<li><p><code>R/generate_codebook.R</code>: this is where we use
meta-programming to evaluate the code in
<code>R/compile_acs_data.R</code> to document the variables and
operations used to calculate derived variables.</p></li>
<li><p><code>R/calculate_cvs.R</code>: this is where we leverage
metadata from the codebook to calculate coefficients of variation (and
other measures of error) for all of the returned variables.</p></li>
<li><p><code>R/make_pretty_names.R</code>: this facilitates using
variable names in charts and tables, so we want to ensure that the
programmatically-generated names of new variables return reasonable
pretty-printed names.</p></li>
</ol>
<p>Our last step is to integrate our proposed changes, execute
<code><a href="../reference/compile_acs_data.html">compile_acs_data()</a></code>, and evaluate the results to ensure that
the changes not only work in isolation, but that they also work as part
of the broader codebase.</p>
</div>
<div class="section level2">
<h2 id="our-variable-series">Our Variable Series<a class="anchor" aria-label="anchor" href="#our-variable-series"></a>
</h2>
<p>We’re going to add a series of estimates that describe “Household
Type”, which are contained in table B11001. We can find the relevant
variables by navigating the codebook returned by
<code><a href="https://walker-data.com/tidycensus/reference/load_variables.html" class="external-link">tidycensus::load_variables()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codebook</span> <span class="op">=</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/load_variables.html" class="external-link">load_variables</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"acs5"</span>, year <span class="op">=</span> <span class="fl">2023</span><span class="op">)</span></span>
<span></span>
<span><span class="va">codebook</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"B11001"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   name        label                                            concept geography</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> B11001A_001 Estimate!!Total:                                 Househ… block gr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> B11001A_002 Estimate!!Total:!!Family households:             Househ… block gr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> B11001A_003 Estimate!!Total:!!Family households:!!Married-c… Househ… block gr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> B11001A_004 Estimate!!Total:!!Family households:!!Other fam… Househ… block gr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> B11001A_005 Estimate!!Total:!!Family households:!!Other fam… Househ… block gr…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> B11001A_006 Estimate!!Total:!!Family households:!!Other fam… Househ… block gr…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rlist_acs_variables">1: <code>R/list_acs_variables()</code><a class="anchor" aria-label="anchor" href="#rlist_acs_variables"></a>
</h2>
<p>We can see how these variables will be renamed behind the scenes in
<code><a href="https://ui-research.github.io/urbnindicators/">library(urbnindicators)</a></code> by providing the table name to
<code><a href="../reference/select_variables_by_name.html">urbnindicators::select_variables_by_name()</a></code>.</p>
<p>These are auto-named reasonably well, but we can make the names more
concise by removing the repeated substring
<code>"including_living_alone_"</code>. Note that each variable names
ends in an <code>_</code>; this is intentional.</p>
<p>This code is then the code that should be added within
<code><a href="../reference/list_acs_variables.html">list_acs_variables()</a></code> under the appropriate commented
header, which in this case is
<code>####----HOUSEHOLD COMPOSITION----####</code>. We’ll then add the
table name in comments above this new code, so that the resulting block
of code will look like the below:</p>
<pre><code>   ####----EMPLOYMENT----####
      ## EMPLOYMENT STATUS FOR THE POPULATION 16 YEARS AND OVER
      employment_civilian_labor_force_universe_ = "B23025_003",
      employment_civilian_labor_force_employed_ = "B23025_004",

   ####----HOUSEHOLD COMPOSITION----####
      ## AVERAGE HOUSEHOLD SIZE OF OCCUPIED HOUSING UNITS BY TENURE
      household_size_average_ = "B25010_001",
      household_size_average_owneroccupied_ = "B25010_002",
      household_size_average_renteroccupied_ = "B25010_003",
      
      ## HOUSEHOLD TYPE (INCLUDING LIVING ALONE)
      select_variables_by_name("B11001_", census_codebook = codebook) %&gt;%
        stats::setNames(names(.) %&gt;% stringr::str_remove_all("including_living_alone_")),
   
   ####----HEALTH INSURANCE----####
      ## HEALTH INSURANCE COVERAGE STATUS AND TYPE BY EMPLOYMENT STATUS
      select_variables("B27011"),</code></pre>
</div>
<div class="section level2">
<h2 id="rcompile_acs_data">2: <code>R/compile_acs_data</code><a class="anchor" aria-label="anchor" href="#rcompile_acs_data"></a>
</h2>
<p>Now we need to calculate any desired variables. In virtually all
cases (excepting, for example, estimates that reflect non-count
quantities, such as medians or percentiles), we will want to calculate
percentages. In some cases, however, we will first want to create
intermediate count variables, such as by summing or subtracting multiple
count variables. In this case, we’ll just calculate percentages.</p>
<p>Selecting an appropriate denominator for percentage variables is
critical, and at times, complex. The basic approach is to simply divide
every variable by the table universe, which should contain
<code>universe</code> in the variable name. But in other cases,
alternate variables may make for more insightful denominators. For
example, if we were interested in the share of family households that
were headed by single male householders, we would want to divide
<code>household_type_family_households_other_family_male_householder_no_spouse_present</code>
by <code>household_type_family_households_</code> rather than by
<code>household_type_universe_</code>.</p>
<p>At this point, we’ll want to obtain some sample data to ensure our
first-pass code is functional. We can do this as so:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_data</span> <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">get_acs</a></span><span class="op">(</span></span>
<span>  years <span class="op">=</span> <span class="fl">2022</span>,</span>
<span>  geography <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>  state <span class="op">=</span> <span class="st">"NJ"</span>,</span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="../reference/select_variables_by_name.html">select_variables_by_name</a></span><span class="op">(</span><span class="st">"B11001_"</span>, census_codebook <span class="op">=</span> <span class="va">codebook</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="st">"including_living_alone_"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">## urbnindicators returns wide, not long, data</span></span>
<span>  <span class="co">## when urbnindicators calculates variables, it does so after de-selecting all </span></span>
<span>  <span class="co">## MOE variables (it joins them back later in the process)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">NAME</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"_E"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## urbnindicators also systematically drops all "_E" suffices, which denote "ESTIMATE"</span></span>
<span>  <span class="co">## variables</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename_with</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="va">.x</span>, <span class="st">"_E"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Getting data from the 2019-2023 5-year ACS</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #00BBBB;">•</span> You have not set a Census API key. Users without a key are limited to 500</span></span>
<span><span class="co">#&gt; queries per day and may experience performance limitations.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> For best results, get a Census API key at</span></span>
<span><span class="co">#&gt; http://api.census.gov/data/key_signup.html and then supply the key to the</span></span>
<span><span class="co">#&gt; `census_api_key()` function to use it throughout your tidycensus session.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once per session.</span></span></span>
<span></span>
<span><span class="va">sample_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 11</span></span></span>
<span><span class="co">#&gt;   GEOID NAME                       household_type_unive…¹ household_type_famil…²</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 34001 Atlantic County, New Jers…                 <span style="text-decoration: underline;">108</span>712                  <span style="text-decoration: underline;">70</span>517</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 34003 Bergen County, New Jersey                  <span style="text-decoration: underline;">353</span>307                 <span style="text-decoration: underline;">252</span>639</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 34005 Burlington County, New Je…                 <span style="text-decoration: underline;">176</span>046                 <span style="text-decoration: underline;">120</span>137</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 34007 Camden County, New Jersey                  <span style="text-decoration: underline;">200</span>569                 <span style="text-decoration: underline;">131</span>150</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 34009 Cape May County, New Jers…                  <span style="text-decoration: underline;">44</span>369                  <span style="text-decoration: underline;">29</span>171</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 34011 Cumberland County, New Je…                  <span style="text-decoration: underline;">53</span>341                  <span style="text-decoration: underline;">36</span>155</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated names: ¹​household_type_universe,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​household_type_family_households</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables:</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   household_type_family_households_married_couple_family &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   household_type_family_households_other_family &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   household_type_family_households_other_family_male_householder_no_spouse_present &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   household_type_family_households_other_family_female_householder_no_spouse_present &lt;dbl&gt;, …</span></span></span></code></pre></div>
<p>We calculate percentages across a series of variables using
<code><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">dplyr::across()</a></code>; the general pattern is:</p>
<pre><code>dplyr::across(
  .cols = dplyr::matches("[UNIQUE REGEX TO MATCH DESIRED NUMERATOR VARIABLES]),
  .fns = ~ .x / [UNIVERSE VARIABLE],
  .names = "{.col}_percent")</code></pre>
<p>In our case, that will be as follows. Note that we explicitly exclude
the universe variable from our selection of numerators–this is an easy
step to forget!</p>
<p>Defining an appropriate selection term for the numerators can be
particularly challenging because we must ensure both that we select the
desired variables and that we don’t unintentionally select any undesired
variables, which can be especially difficult when applied to the real
case, where we’re not selecting from our <code>sample_data</code> object
but from the full suite of variables returned by
<code>urbnindicators</code>. To help evaluate and prevent such issues,
users should call <code><a href="../reference/compile_acs_data.html">compile_acs_data()</a></code> and ensure that the
selection term they develop during this stage does not select any of the
variables that are already returned by
<code><a href="../reference/compile_acs_data.html">compile_acs_data()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      .cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"household_type"</span><span class="op">)</span>, <span class="op">-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"universe"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      .fns <span class="op">=</span> <span class="op">~</span> <span class="va">.x</span> <span class="op">/</span> <span class="va">household_type_universe</span>,</span>
<span>      .names <span class="op">=</span> <span class="st">"{.col}_percent"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## just to print out a subset of our results</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   household_type_family_househol…¹ household_type_famil…² household_type_famil…³</span></span>
<span><span class="co">#&gt;                              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                            0.649                  0.444                  0.205</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                            0.715                  0.558                  0.157</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                            0.682                  0.524                  0.159</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                            0.654                  0.441                  0.213</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>                            0.657                  0.517                  0.141</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>                            0.678                  0.420                  0.258</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated names: ¹​household_type_family_households_percent,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​household_type_family_households_married_couple_family_percent,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ³​household_type_family_households_other_family_percent</span></span></span></code></pre></div>
<p>If we’re satisfied with the resulting estimates, we can add this code
into <code>compile_acs_data.R</code>, within
<code><a href="../reference/internal_compute_acs_variables.html">internal_compute_acs_variables()</a></code>. Akin to our preceding
step, this new code should be organized under the
<code>####----HOUSEHOLD COMPOSITION----####</code> comment header.</p>
</div>
<div class="section level2">
<h2 id="rgenerate_codebook-r">3: <code>R/generate_codebook.R</code><a class="anchor" aria-label="anchor" href="#rgenerate_codebook-r"></a>
</h2>
<p>If all has gone well, there will be no new code to add to
<code><a href="../reference/generate_codebook.html">generate_codebook()</a></code>– new variables should be automatically
documented by the function and included in the resulting codebook object
that is attached as an attribute to the primary dataframe returned by
<code><a href="../reference/compile_acs_data.html">compile_acs_data()</a></code>. However, we should meticulously verify
that each new variable is in fact documented in the codebook, and that
its documentation is accurate. If the documentation is incorrect, the
error we estimate for derived variables will also be incorrect.</p>
<p>Note that if the documentation is incorrect, the user creating the PR
should still open the PR and should note the issue with the
documentation; the PR should not include any changes to
<code><a href="../reference/generate_codebook.html">generate_codebook()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="rcalculate_cvs-r">4: <code>R/calculate_cvs.R</code><a class="anchor" aria-label="anchor" href="#rcalculate_cvs-r"></a>
</h2>
<p>Like with step 3 above, if all has gone well, there will be no new
code to add to <code><a href="../reference/calculate_cvs.html">calculate_cvs()</a></code>. Here again, the primary
task is to check that coefficients of variation appear reasonable (and
if not, to flag any concerns in the PR).</p>
<p>At this stage, users should also check the magnitude of errors for
all variables –raw ACS estimates and
<code>urbnindicators</code>-calculated variables alike–across smaller
geographies, such as all tracts in one or more states. If CVs are large
(e.g., over 50) for a large share of all tracts, this may indicate that
the series of interest is not appropriate for tract-level analysis.
Because <code>urbnindicators</code> is designed to facilitate
tract-level analysis, variables that are consistently unreliable at the
tract-level will not be integrated into the codebase.</p>
</div>
<div class="section level2">
<h2 id="rmake_pretty_names-r">5: <code>R/make_pretty_names.R</code><a class="anchor" aria-label="anchor" href="#rmake_pretty_names-r"></a>
</h2>
<p>Finally, we need to ensure that the new variables have reasonable
names. We can evaluate this easily with our sample data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      .cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"household_type"</span><span class="op">)</span>, <span class="op">-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"universe"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      .fns <span class="op">=</span> <span class="op">~</span> <span class="va">.x</span> <span class="op">/</span> <span class="va">household_type_universe</span>,</span>
<span>      .names <span class="op">=</span> <span class="st">"{.col}_percent"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">urbnindicators</span><span class="fu">::</span><span class="fu"><a href="../reference/make_pretty_names.html">make_pretty_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Geoid"                                                                                 </span></span>
<span><span class="co">#&gt;  [2] "Name"                                                                                  </span></span>
<span><span class="co">#&gt;  [3] "Household Type (Universe)"                                                             </span></span>
<span><span class="co">#&gt;  [4] "Household Type Family Households"                                                      </span></span>
<span><span class="co">#&gt;  [5] "Household Type Family Households Married Couple Family"                                </span></span>
<span><span class="co">#&gt;  [6] "Household Type Family Households Other Family"                                         </span></span>
<span><span class="co">#&gt;  [7] "Household Type Family Households Other Family Male Householder No Spouse Present"      </span></span>
<span><span class="co">#&gt;  [8] "Household Type Family Households Other Family Female Householder No Spouse Present"    </span></span>
<span><span class="co">#&gt;  [9] "Household Type Nonfamily Households"                                                   </span></span>
<span><span class="co">#&gt; [10] "Household Type Nonfamily Households Householder Living Alone"                          </span></span>
<span><span class="co">#&gt; [11] "Household Type Nonfamily Households Householder Not Living Alone"                      </span></span>
<span><span class="co">#&gt; [12] "Household Type Family Households (%)"                                                  </span></span>
<span><span class="co">#&gt; [13] "Household Type Family Households Married Couple Family (%)"                            </span></span>
<span><span class="co">#&gt; [14] "Household Type Family Households Other Family (%)"                                     </span></span>
<span><span class="co">#&gt; [15] "Household Type Family Households Other Family Male Householder No Spouse Present (%)"  </span></span>
<span><span class="co">#&gt; [16] "Household Type Family Households Other Family Female Householder No Spouse Present (%)"</span></span>
<span><span class="co">#&gt; [17] "Household Type Nonfamily Households (%)"                                               </span></span>
<span><span class="co">#&gt; [18] "Household Type Nonfamily Households Householder Living Alone (%)"                      </span></span>
<span><span class="co">#&gt; [19] "Household Type Nonfamily Households Householder Not Living Alone (%)"</span></span></code></pre></div>
<p>Though these names are far from perfect, they’re reasonably concise
and descriptive, and there are no problematic words that are lost in the
pretty-ifying process (e.g., acronyms, series of numbers, etc.). We can
leave it to users to make other adjustments, such as removing the
substring “Household Type”, if they want even more concise names.</p>
</div>
<div class="section level2">
<h2 id="evaluate-changes-by-calling-compile_acs_data">6: Evaluate Changes by Calling <code>compile_acs_data()</code><a class="anchor" aria-label="anchor" href="#evaluate-changes-by-calling-compile_acs_data"></a>
</h2>
<p>Lastly, users should ensure that the code they’ve developed in
isolation for their PR functions as intended, and without unanticipated
side effects, by integrating their proposed changes into the codebase
(on their branch), loading the current version of
<code>urbnindicators</code> (which is done by calling
<code>devtools::load_all()</code> in the console), and then calling
<code><a href="../reference/compile_acs_data.html">compile_acs_data()</a></code> in a scratch file and interactively
exploring both the data and codebook.</p>
</div>
<div class="section level2">
<h2 id="open-the-pr">7: Open the PR<a class="anchor" aria-label="anchor" href="#open-the-pr"></a>
</h2>
<p>Once users are satisfied with the proposed code (and/or have noted
any issues), they should click on their branch in the GitHub repository
and click <code>New pull request</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Will Curran-Groome.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
